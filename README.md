<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [License and Terms of Service][1]
-   [Usage][2]
-   [Code Reference][3]
    -   [getConfig][4]
        -   [Parameters][5]
    -   [getData][6]
        -   [Parameters][7]
    -   [getSchema][8]
        -   [Parameters][9]
    -   [isAdminUser][10]
-   [Auth][11]
    -   [authCallback][12]
        -   [Parameters][13]
    -   [get3PAuthorizationUrls][14]
    -   [getAuthType][15]
    -   [getOAuthService][16]
    -   [isAuthValid][17]
    -   [resetAuth][18]
-   [Utils][19]
    -   [buildRows][20]
        -   [Parameters][21]
    -   [deriveSchema][22]
        -   [Parameters][23]
    -   [filterUserDefinedParams][24]
        -   [Parameters][25]
    -   [requestPCO][26]
        -   [Parameters][27]

## License and Terms of Service

-   [https://creativecommons.org/licenses/by-sa/4.0/][28]


## Usage

### Google Apps Script Setup

1.  Use this wizard to create a new Google Cloud Platform Project and enable and authorize Apps Scripts ([https://console.cloud.google.com/flows/enableapi?apiid=script][29]) 

-   Fill out the contact information and select "Web Application" as the client type
-   No need to worry about domain or callback URL

2.  Go into settings and find the project ID. You will need it in Apps Scripts
3.  Create a new Apps Script project ([https://script.google.com/home/projects/create][30])
4.  Enable Chrome V8 runtime in the Apps Script project settings
5.  Also in the Apps Script project, set the Google Cloud Project ID to that created in step 1
6.  Note the OAuth2 callback URL needed for PCO: ([https://script.google.com/macros/d/{SCRIPT_ID}/usercallback][31])
7.  Copy all the files as they are from this repo into the script. you can also use clasp for this
8.  Ensure you create an empty .credentials.js file. This is NOT checked into source control

### Planning Center Setup

9.  Create a devloper account with Planning Center Online ([https://developer.planning.center/][32])
10. Create an OAuth2 Application ([https://api.planningcenteronline.com/oauth/applications][33])
11. Ensure the API versions match the versions you define in _endpoints.js_
12. Set the callback URI to the value recorded in step 6
13. Copy the credentials into the Apps Script project .credentials.js file created in step 8

```js
  const CLIENT_ID = "pco_client_id";
  const SECRET = "pco_clinet_secret";
  const ADMINS = [
    "admin1@some.email",
    "admin2@some.email"
  ];
```

### Using the connector

14. Deploy the Apps Script project from manifest
15. Copy the Deployment ID
16. Create a new Data Studio data source ([https://datastudio.google.com/datasources/create/][34])
17. Select "Build Your Own"
18. Paste in the Deployment ID and click "validate"
19. Select the connector
20. Follow the Oauth2 prompts and sign in to PCO
21. Configure the desired endpoint
22. Once the connector is added to a report you can pass additinal supported params (per PCO API docs) as "pco\_{{param name}}"
23. Each deployment creates a new activation ID and the new version must be re-added to any exisitng reports for the change to apply.

### Questions or Problems

-   Please create a github issue and we will do our best to address your concern or question.
-   Please note this is not a supported product and there is no SLA or support options. We will simply do our best to help as we can.
-   This repo is offered with no warranty, expressed or implied.
-   Contributions are welcome through pull requests.     


## Code Reference




### getConfig

-   **See: [https://developers.google.com/datastudio/connector/reference#getconfig][35]
    **

Returns the user configurable options for the connector.

#### Parameters

-   `request` **[object][36]** A JavaScript object containing the config request parameters.

Returns **[object][36]** results from config.build()

### getData

-   **See: [https://developers.google.com/datastudio/connector/reference#getdata][37]
    **

Returns the tabular data for the given request.

#### Parameters

-   `request` **[object][36]** @param {Object} A JavaScript object containing the data request parameters.

Returns **[object][36]** schema and API data

### getSchema

-   **See: [https://developers.google.com/datastudio/connector/reference#getschema][38]
    **

Returns the schema for the given request. This provides the information about how the connector's data is organized.

#### Parameters

-   `request` **[object][36]** A JavaScript object containing the schema request parameters.

Returns **[object][36]** schema for specified fields

### isAdminUser

Checks if the user is an admin of the connector. This function is used to enable/disable debug features.

Returns **[boolean][39]** 

## Auth




### authCallback

The OAuth callback.

#### Parameters

-   `request` **[object][36]** The request data received from the OAuth flow.

Returns **HtmlOutput** The HTML output to show to the user.

### get3PAuthorizationUrls

-   **See: [https://developers.google.com/apps-script/reference/script/authorization-info][40]
    **

Gets the 3P authorization URL.

Returns **[string][41]** The authorization URL.

### getAuthType

Returns the Auth Type of this connector.

Returns **[object][36]** The Auth type.

### getOAuthService

Returns the configured OAuth Service.

Returns **Service** The OAuth Service

### isAuthValid

Returns true if the auth service has access.

Returns **[boolean][39]** True if the auth service has access.

### resetAuth

Resets the auth service.

## Utils




### buildRows

Fileters and formats raw data from PCO into structure required by Data Studio

#### Parameters

-   `selectedFields` **[array][42]** attributes user selected to display (optional, default `[]`)
-   `rawApiData` **[array][42]** raw responses from PCO API (optional, default `[]`)
-   `selectedAPI`  

Returns **[array][42]** array of row objects

### deriveSchema

Creates schema for the selected API

#### Parameters

-   `selectedApiConfig` **[object][36]** config object for selected API

Returns **[object][36]** Data Studio fields

### filterUserDefinedParams

request.configParams filter for user specified parameters

#### Parameters

-   `configParams` **any** request.configParams (optional, default `{}`)

Returns **[object][36]** user defined parameters

### requestPCO

Recursive function that fetches API data from PCO

#### Parameters

-   `selectedAPI` **[string][41]** selected API
-   `options` **[object][36]** fetch options (optional, default `{}`)

Returns **[array][42]** array of API data objects

[1]: #license-and-terms-of-service

[2]: #usage

[3]: #code-reference

[4]: #getconfig

[5]: #parameters

[6]: #getdata

[7]: #parameters-1

[8]: #getschema

[9]: #parameters-2

[10]: #isadminuser

[11]: #auth

[12]: #authcallback

[13]: #parameters-3

[14]: #get3pauthorizationurls

[15]: #getauthtype

[16]: #getoauthservice

[17]: #isauthvalid

[18]: #resetauth

[19]: #utils

[20]: #buildrows

[21]: #parameters-4

[22]: #deriveschema

[23]: #parameters-5

[24]: #filteruserdefinedparams

[25]: #parameters-6

[26]: #requestpco

[27]: #parameters-7

[28]: https://creativecommons.org/licenses/by-sa/4.0/

[29]: https://console.cloud.google.com/flows/enableapi?apiid=script

[30]: https://script.google.com/home/projects/create

[31]: https://script.google.com/macros/d/{SCRIPT_ID}/usercallback

[32]: https://developer.planning.center/

[33]: https://api.planningcenteronline.com/oauth/applications

[34]: https://datastudio.google.com/datasources/create/

[35]: https://developers.google.com/datastudio/connector/reference#getconfig

[36]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[37]: https://developers.google.com/datastudio/connector/reference#getdata

[38]: https://developers.google.com/datastudio/connector/reference#getschema

[39]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean

[40]: https://developers.google.com/apps-script/reference/script/authorization-info

[41]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[42]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array
